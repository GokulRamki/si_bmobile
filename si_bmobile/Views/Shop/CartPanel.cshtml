@{    
    Layout = null;
}

<html>
<head>
    <title>TEST CART</title>
    <style type="text/css">
        thead td { height:40px; line-height:40px; font-weight:bold; }
        tbody td { height:40px; line-height:40px; border-bottom:1px dotted #DDD; }
        .ui-widget
        {
            font-size: 0.8em;
        }

        .ui-widget-header
        {
            border: 2px solid rgb(170, 170, 170);
            background: #333333;
            font-weight: 600;
            color: rgb(211, 123, 67);
        }

        .cell .ui-widget
        {
            font-size: 0.6em;
        }

        .bmob-ui-dialog
        {
        }

            .bmob-ui-dialog .shield
            {
                background: none repeat scroll 0 0 #333333;
                height: 100%;
                left: 0;
                opacity: 0.5;
                position: fixed;
                top: 0;
                width: 100%;
                z-index: 1000;
            }

            .bmob-ui-dialog .window-absolute
            {
                position: absolute;
            }

            .bmob-ui-dialog .window
            {
                padding: 10px;
                text-align: left;
                z-index: 1001;
            }

            .bmob-ui-dialog .content
            {
                background: none repeat scroll 0 0 #FFFFFF;
                height: 100%;
            }

        .cart-head
        {
            background: linear-gradient(to bottom, rgb(247, 114, 25) 1%, rgb(254, 198, 167) 3%, rgb(247, 114, 25) 7%, rgb(247, 91, 22) 100%) repeat scroll 0px 0px transparent;
            color: white;
        }

        .bmob-uppercase
        {
            text-transform: uppercase;
        }

        .newvd.cart-dialog .dialog-header
        {
            background-color: #FFFFFF;
            height: auto;
            padding: 5px 5px 0 12px;
            color: #333333;
            font-size: 16px;
            font-weight: bold;
        }

        .newvd #shopping-cart-header
        {
            height: 40px;
        }

        .bmobclear, .cls
        {
            clear: both;
        }

        .newvd.cart-dialog .dialog-body
        {
            border-top: 1px solid #333333;
            height: 100%;
        }

        .newvd.cart-dialog #panelsh
        {
            padding: 0 0 15px;
            height: 100%;
            overflow: hidden;
        }

        .newvd.cart-dialog .dialog-body .container
        {
            position: relative;
        }

        .bmob-height-full
        {
            height: 100%;
        }

        .bmob-hidden, .hidden
        {
            display: none;
        }

        .cart_contents
        {
            padding: 0;
        }

            .cart_contents.newvd
            {
                color: #565656;
            }

        .newvd #panelsh .main-body-internal
        {
            height: auto;
            padding: 0 0;
        }

        #panelsh .main-body-internal
        {
            overflow-y: auto;
        }

        table
        {
            border-collapse: collapse;
            border-spacing: 0;
        }

        .cart_contents.newvd .cart-table .image-cell
        {
            width: 17%;
        }

        .cart_contents.newvd .cart-table .item-cell
        {
            width: 59%;
        }

        .cart_contents.newvd .cart-table .qty-cell
        {
            width: 10%;
        }

        .cart_contents.newvd .cart-table .price-cell
        {
            width: 31%;
        }

        .cart_contents.newvd .cart-table .subtotal-cell
        {
            width: 12%;
        }

        .cart_contents.newvd .head-cell
        {
            padding: 10px 0 7px;
        }

        .cart_contents.newvd .cart-body .image-cell
        {
            padding: 15px 10px 10px;
        }

        .cart_contents.newvd .cart-body .cell
        {
            padding: 30px 10px 10px;
            vertical-align: top;
        }

        .cart_contents.newvd .cart-body .qty-cell
        {
            background: none repeat scroll 0 0 #FCFCFC;
        }

        .cart_contents.newvd .cart-table .cell
        {
            border-bottom: 1px dotted #C0C0C0;
            vertical-align: top;
        }

        .cart-dialog .close-icon
        {
            top: 16px;
            right: 16px;
        }

        .bmob-ui-dialog .close-icon
        {
            position: absolute;
            cursor: pointer;
        }

        .bmob-ui-dialog .header-close-icon
        {
            height: 28px;
            width: 28px;
            background: url("");
        }

        .newvd .seller-orders
        {
            border-bottom: none;
            border-top: 2px solid #565656;
            position: relative;
        }

            .newvd .seller-orders .seller-name
            {
                background: none repeat scroll 0 0 #FFFFFF;
                margin: -10px;
                padding: 0 10px 0 0;
                position: absolute;
            }

        .line, .lastUnit
        {
            overflow: hidden;
        }

        .bmob-font-11
        {
            font-size: 11px;
        }

        .bmob-fontlight, .font-color-medium
        {
            color: #848484;
        }

        .bmargin5
        {
            margin-bottom: 5px;
        }

        #cart-tab-content .cart-footer
        {
            padding: 0 15px;
        }

        .bmob-border-top
        {
            border-top: 2px solid #333333;
        }

        .newvd.cart-dialog .cart-footer.fixed .price-bar
        {
            box-shadow: 0 -5px 8px -6px #888888;
        }

        .cart_contents.newvd .cart-footer .price-bar
        {
            background: none repeat scroll 0 0 #F9F9F9;
            border-bottom: 1px solid #F2F2F2;
            color: #333333;
            padding: 10px 0;
        }

        .size1of2
        {
            width: 50%;
        }

        .unit
        {
            float: left;
        }

        .unitExt
        {
            float: right;
        }

            .unitExt a
            {
                color: #333333;
            }

        .text_right
        {
            text-align: right;
        }

        .lastUnit
        {
            float: none;
            width: auto;
        }

        .boldtext, .bmob-font-bold, .bold_text
        {
            font-weight: bold;
        }

        .rpadding10
        {
            padding-right: 10px;
        }

        .bmob-font-verybig
        {
            font-size: 22px;
        }

        .bmob-font-26
        {
            font-size: 26px;
        }

        .btn
        {
            display: inline-block;
            line-height: 1.3;
            text-align: center;
            text-transform: uppercase;
        }

            .btn.btn-medium
            {
                font-size: 13px;
                padding: 8px 12px;
            }

            .btn.btn-white
            {
                background: linear-gradient(to bottom, #F9F9F9 1%, #FFFFFF 3%, #F9F9F9 7%, #F2F2F2 100%) repeat scroll 0 0 rgba(0, 0, 0, 0);
                border: 1px solid #C9C9C9;
                color: #333333;
            }

            .btn.btn-buy-big
            {
                font-size: 18px;
                padding: 8px 0;
                width: 232px;
            }

            .btn.btn-orange
            {
                background: linear-gradient(to bottom, #F77219 1%, #FEC6A7 3%, #F77219 7%, #F75B16 100%) repeat scroll 0 0 rgba(0, 0, 0, 0);
                border: 1px solid #EC6723;
            }

        tbody tr td
        {
            font-size: 14px;
            font-weight: 600;
            font: Arial,Helvetica,sans-serif;
        }

        .ui-dialog .ui-dialog-content
        {
            padding: 0px;
            font: Arial,Helvetica,sans-serif;
        }

        .ui-widget-content
        {
            border: 2px solid rgb(170, 170, 170);
        }
/*              Loading Image 
----------------------------------------------------------*/
        .loadingpan
{
    margin: 0px;
    padding: 0px;
    position: fixed;
    right: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    background-color: #666666;
    -khtml-opacity: 0.8;
    -moz-opacity: 0.8;
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";
    filter: alpha(opacity=80);
    opacity: .80;
    display: none;
    z-index: 30001;
}
.loading_box
{
    position: absolute;
    width:200px;
    top: 30%;
   left: 50%;
    margin-left: -100px;
    color: gray;
    font-size: 18px;
    background-color: #ddd;
    text-align: center;
    padding: 10px;       
}
    </style>
    <script src="@Url.Content("~/Scripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
    <script src="~/Scripts/knockout-3.0.0.js"></script>
    <script src="@Url.Content("~/Scripts/knockout-3.0.0.debug.js")" type="text/javascript"></script>
    <script type="text/javascript">      
        function formatCurrency(value) {
            return "K " + value.toFixed(2);
        }

        function ProductViewModel() {

            //Make the self as 'this' reference
            var self = this;
            //Declare observable which will be bind with UI 
            self.product_id = ko.observable("");
            self.ProductName = ko.observable("");
            self.product_qty = ko.observable("");
            self.product_price = ko.observable("");
            self.Sub_total_price = ko.observable("");
          
            var Product = {
                product_id: self.product_id,
                ProductName: self.ProductName,
                product_qty: self.product_qty,
                product_price: self.product_price,
                Sub_total_price: self.Sub_total_price
            };

            self.Product = ko.observable();
            self.Products = ko.observableArray();   // Contains the list of products

            // Initialize the view-model
            $.ajax({
                url: '@Url.Action("GetAllProducts", "Shop")',
                cache: false,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                data: {},
                success: function (data) {
                    self.Products(data); //Put the response in ObservableArray
                    $('.dialog-body').css('display', 'block');
                    $('.loadingpan').css('display', 'none');
                }
            });

            // Calculate Total of Price After Initialization
            self.Total = ko.computed(function () {
                var sum = 0;
                var arr = self.Products();
                for (var i = 0; i < arr.length; i++) {
                    sum += arr[i].Sub_total_price;
                }
                return sum;
            });
            
            // Update product details
            self.update = function (Product) {
               
                $.ajax({
                    url: '@Url.Action("UpdateProduct", "Shop")',
                    cache: false,
                    type: 'PUT',
                    contentType: 'application/json; charset=utf-8',
                    data: ko.toJSON(Product),
                    success: function (data) {
                        self.Products.removeAll();
                        self.Products(data); //Put the response in ObservableArray
                        self.Product(null);
                        //alert("Quantity Updated Successfully");
                    }
                })
                .fail(
                function (xhr, textStatus, err) {
                    //alert(err);
                });
            }

            // Delete product details
            self.delete = function (Product) {                
                
                $.ajax({
                    url: '@Url.Action("DeleteProduct", "Shop")',
                    cache: false,
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    data: ko.toJSON(Product),
                    success: function (data) {
                        self.Products.remove(Product);
                        //   alert("Record Deleted Successfully");
                    }
                }).fail(
                     function (xhr, textStatus, err) {
                         alert(err);
                     });
            }
        }
        var viewModel = new ProductViewModel();       

        ko.applyBindings(viewModel);
    </script>
</head>
<body>

    <div id="divLoading" class="loadingpan" >
    <div class="loading_box">
        <img src="~/Content/themes/base/images/loading.gif" alt="Loading.." /><br />
        Loading, please wait...
    </div>
</div>
    <div class="bmob-ui-dialog newvd cart-dialog">

        @* <div class="shield"></div>*@

        <div class="window alpha30 window-absolute" style="width: 890px;">
            <div class="content">
                <!--   header    --->
                @*        <div class="dialog-header">
            <div id="shopping-cart-header" class="fk-hidden" style="display: block;">

            </div>
            <div class="cls"></div>
        </div>*@
                <!-- end header   -->
                <!-- Main Content -->
                <div class="cls"></div>
                <div class="dialog-body"  style="display:none;">
                    <div id="panelsh" class="a-hover-underline" style="display: block;">
                        <div class="container bmob-height-full cart-container">
                            <div class="tab-contents bmob-height-full">
                                <div class="cart_contents newvd">
                                    <div class="main-body-internal ">
                                        <table class="cart-table" width="100%" cellspacing="0" cellpadding="0" data-bind="visible: Products().length > 0">                                            
                                            <thead class="bmob-uppercase cart-head">
                                                <tr>
                                                    <td style="width:50%;">Item
                                                    </td>
                                                    <td style="width:15%;">Qty
                                                    </td>                                                   
                                                    <td style="width:15%;">Price
                                                    </td>
                                                    <td style="width:15%;">Subtotal
                                                    </td>   
                                                    <td style="width:5%;"></td>                                                
                                                </tr>
                                            </thead>
                                            <tbody class="cart-body" data-bind="foreach: Products">
                                                <tr>
                                                    <td>
                                                        <span data-bind="text: ProductName"></span>
                                                        <input data-bind="value: product_id" type="hidden" />
                                                    </td>
                                                    <td>
                                                        <input data-bind="value: product_qty, valueUpdate: 'keyup'" style="width:30px;" type="text" title="Name" />&nbsp;
                                                        <button data-bind="click: $root.update" style="border:none; background-color:none; background:none; cursor:pointer; color:orange;">Update</button>                                                        
                                                    </td>
                                                    <td style="text-align:right;" data-bind="text: formatCurrency(product_price)"></td>
                                                    <td style="text-align:right;" data-bind="text: formatCurrency(Sub_total_price)"></td>
                                                    <td>
                                                        <button data-bind="click: $root.delete" style="border:none; background-color:none; background:none; cursor:pointer;">x</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- footer  -->
                                    <div class="cart-footer bpadding10 fixed">
                                        <div class="bmob-border-top price-bar line"  data-bind="visible: Products().length > 0">
                                            <div class="unit size1of2"></div>
                                            <div class="lastUnit text_right">
                                                <p class="bmob-font-bold rpadding10"></p>
                                                <div style="text-align:right;" class="total bmob-font-verybig rpadding10">
                                                    <span class="bmob-font-26">
                                                        <span data-bind="text: formatCurrency($root.Total())"></span>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="cls"></div>
                                        </div>
                                        <div data-bind="visible: Products().length == 0"><h2>Your Cart is Empty</h2></div>
                                        <div style="margin-top:10px; width:100%;">
                                            <input type="button" value="Continue Shopping" onclick="window.location='/Shop/Products'" style="float:left;"/>
                                            <span data-bind="visible: Products().length > 0"   style="float:right;">
                                            <input type="button" value="Confirm" onclick="window.location = '/Shop/Confirm'"  />
                                                </span>
                                        </div>                                       
                                    </div>
                                    <!-- end footer -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div id="backgroundFilter">
    </div>
</body>
</html>
